<!doctype html>
<html lang="es-ES">
    <head>
        <style>
        </style>
    </head>
    <body>
        <div class="js-map"></div>

        <script src="../lib/d3.v4.min.js"></script>
        <script src="../lib/topojson.min.js"></script>
        <script src="rbush.js"></script>
        <script src="../spam.js"></script>
        <script type='text/javascript'>
        /*
        {
            features: (make it optional!),
            static: {
                prepaint:,
                paintfeature:,
                postpaint:
            },
            dynamic: {
                prepaint:,
                postpaint:
            },
            click:
        }
        */
            // TODO queue.js
            d3.json("map.json", function(error, d) {
                d3.json("roads.json", function(error, roads) {
                    topojson.presimplify(d)
                    topojson.presimplify(roads)

                    var hover = null
                    var map = new ZoomableCanvasMap({
                        element: ".js-map",
                        data: [{
                            features: topojson.feature(d, d.objects["provincias"]),
                            static: {
                                paintfeature: function(parameters, d) {
                                    if (d.properties.name[0] < "H")
                                        parameters.context.fillStyle = "blue"
                                    else
                                        parameters.context.fillStyle = "red"
                                    parameters.context.fill()
                                }
                            },
                            dynamic: {
                                postpaint: function(parameters) {
                                    if (!hover)
                                        return
                                    parameters.context.beginPath()
                                    parameters.context.lineWidth = 1 / parameters.scale
                                    parameters.path(hover)
                                    parameters.context.stroke()
                                }
                            },
                            events: {
                                click: function(parameters, d) { // TODO replace map with parameters?
                                    console.log("CLICK")
                                    parameters.map.zoom(d)
                                },
                                hover: function(parameters, d) {
                                    if (d)
                                        console.log("HOVER " + d.properties.name)
                                    hover = d
                                    parameters.map.paint()
                                }
                            }
                        },
                        {
                            features: topojson.feature(roads, roads.objects["roads"]),
                            static: {
                                paintfeature: function(parameters, d) {
                                    parameters.context.lineWidth = 1 / parameters.scale
                                    parameters.context.strokeStyle = "black"
                                    parameters.context.stroke()
                                }
                            }
                        }]
                    })
                    map.init()
                })
            })
        </script>
    </body>
</html>
