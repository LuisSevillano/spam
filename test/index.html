<!doctype html>
<html lang="es-ES">
    <head>
        <style>
        </style>
    </head>
    <body>
        <div class="js-map"></div>

        <script src="d3.js"></script>
        <script src="topojson.js"></script>
        <script src="rbush.js"></script>
        <script src="../spam.js"></script>
        <script type='text/javascript'>
            // TODO queue.js
            d3.json("map.json", function(error, d) {
                d3.json("roads.json", function(error, roads) {
                    topojson.presimplify(d)
                    topojson.presimplify(roads)

                    var clicked = []
                    var map = new ZoomableCanvasMap({
                        element: ".js-map",
                        data: [{
                            features: topojson.feature(d, d.objects["provincias"]),
                            prepaint: function(parameters) {

                            },
                            paintfeature: function(parameters, d) {
                                if (d.properties.name[0] < "H")
                                    parameters.context.fillStyle = "blue"
                                else
                                    parameters.context.fillStyle = "red"
                                parameters.context.fill()
                            },
                            postpaint: function(parameters) {

                            },
                            dynamicpaint: function(parameters, hover) {
                                if (!hover)
                                    return
                                parameters.context.beginPath()
                                parameters.context.lineWidth = 1 / parameters.scale
                                parameters.path(hover)
                                parameters.context.stroke()
                            },
                            click: function(parameters, d) { // TODO replace map with parameters?
                                parameters.map.zoom(d)
                            }
                        },
                        {
                            features: topojson.feature(roads, roads.objects["roads"]),
                            paintfeature: function(parameters, d) {
                                parameters.context.lineWidth = 1 / parameters.scale
                                parameters.context.strokeStyle = "black"
                                parameters.context.stroke()
                            }
                        }]
                    })
                    map.init()
                })
            })
        </script>
    </body>
</html>
